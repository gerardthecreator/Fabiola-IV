<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis de Movimiento Rectilíneo</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Oswald:wght@300;400;500&display=swap" rel="stylesheet">

    <!-- MathJax para renderizar LaTeX -->
    <script>
        MathJax = {
            tex: { 
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: { fontCache: 'global' },
            // --- CORRECCIÓN 1: Añadir el bloque startup para manejar la carga asíncrona ---
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    document.dispatchEvent(new Event('MathJaxReady'));
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

    <style>
        :root { --bg-color: #e0e0e0; --primary-font-color: #3c3c3c; --accent-color: #16a085; --accent-color-dark: #117a65; --graph-line-color: #2980b9; --card-padding: 1.5rem; --card-border-radius: 1.25rem; --font-title: 'Anton', sans-serif; --font-body: 'Oswald', sans-serif; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-body); background-color: var(--bg-color); color: var(--primary-font-color); line-height: 1.7; padding: 1.25rem; display: flex; justify-content: center; }
        main { max-width: 800px; width: 100%; }
        h1, h2, h3 { font-family: var(--font-title); letter-spacing: 1px; color: #333; text-align: center; margin-bottom: 1.25rem; }
        h1 { font-size: 2.5rem; text-transform: uppercase; }
        h2 { font-size: 1.8rem; }
        h3 { font-size: 1.5rem; text-align: left; color: var(--accent-color); margin-top: 2rem; }
        p, li { font-size: 1.1rem; font-weight: 300; margin-bottom: 1rem; }
        strong { font-weight: 500; }
        table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; font-size: 1.1rem; }
        th, td { border: 1px solid #bebebe; padding: 0.75rem; text-align: center; }
        th { background-color: #d0d0d0; font-family: var(--font-title); letter-spacing: 1px; }
        .card { background: var(--bg-color); padding: var(--card-padding); border-radius: var(--card-border-radius); margin-bottom: 2rem; box-shadow: 9px 9px 16px #bebebe, -9px -9px 16px #ffffff; }
        
        #visualizacion-container { display: flex; flex-direction: column; align-items: center; gap: 1rem; }
        #grafica-svg { background: var(--bg-color); border-radius: var(--card-border-radius); box-shadow: inset 7px 7px 14px #bebebe, inset -7px -7px 14px #ffffff; width: 100%; max-width: 500px; height: auto; aspect-ratio: 5/4; }
        .anim-controls { display: flex; gap: 1rem; width: 100%; justify-content: center; }
        .anim-btn { font-family: var(--font-body); font-size: 1rem; font-weight: 400; padding: 0.8rem 1.5rem; border: none; border-radius: 0.8rem; cursor: pointer; background: var(--bg-color); box-shadow: 5px 5px 10px #bebebe, -5px -5px 10px #ffffff; transition: all 0.2s ease-in-out; color: var(--primary-font-color); }
        .anim-btn:hover { color: var(--accent-color); }
        .anim-btn:active, .anim-btn:focus { box-shadow: inset 3px 3px 7px #bebebe, inset -3px -3px 7px #ffffff; color: var(--accent-color-dark); outline: 2px solid var(--accent-color); outline-offset: 2px; }
        .anim-btn:disabled { color: #999; cursor: not-allowed; box-shadow: inset 3px 3px 7px #bebebe, inset -3px -3px 7px #ffffff; }
        #anim-description { width: 100%; text-align: center; font-size: 1.1rem; font-weight: 500; color: var(--accent-color-dark); min-height: 3em; background: #e8f6f3; padding: 0.75rem; border-radius: 0.8rem; border-left: 5px solid var(--accent-color); }
        
        .formula-box { background: var(--bg-color); padding: 1.25rem; margin-top: 1rem; border-radius: 1rem; box-shadow: inset 5px 5px 10px #bebebe, inset -5px -5px 10px #ffffff; text-align: center; overflow-x: auto; }
        #respuestas-container .respuesta-item { font-size: 1.2rem; font-weight: 400; background: #e8f6f3; color: var(--accent-color-dark); padding: 1rem; border-radius: 0.6rem; border-left: 5px solid var(--accent-color); margin-bottom: 0.6rem; }
    </style>
</head>
<body>

    <main>
        <h1 id="main-title"></h1>
        <section id="enunciado-container" class="card"></section>

        <section id="visualizacion-container" class="card">
            <h2>Gráfica Interactiva (x vs t)</h2>
            <div id="anim-description"></div>
            <svg id="grafica-svg" viewBox="0 0 500 400"></svg>
            <div class="anim-controls">
                <button id="btn-prev" class="anim-btn">Anterior</button>
                <button id="btn-next" class="anim-btn">Siguiente</button>
            </div>
        </section>

        <section id="solucion-container" class="card"></section>
        <section id="respuestas-container" class="card" aria-live="polite"></section>
    </main>

    <!-- TEMPLATES -->
    <template id="template-enunciado"><h2 class="enunciado-titulo"></h2><div class="enunciado-parrafos"></div></template>
    <template id="template-solucion"><div class="step-card"><h3 class="solucion-step-titulo"></h3><p class="solucion-step-explicacion"></p><div class="formula-box solucion-step-formula"></div></div></template>
    <template id="template-respuesta"><p class="respuesta-item"></p></template>

    <script>
    const ejercicioRectilineo = {
        titulo: "Ejercicio: Análisis de Movimiento Rectilíneo",
        enunciado: {
            titulo: "Enunciado",
            parrafos: [
                "<p>Un objeto se desplaza a lo largo del eje X. Se registran seis puntos de posición y tiempo que describen su movimiento.</p>" +
                "<table>" +
                "<tr><th>Punto</th><th>Tiempo (t) (s)</th><th>Posición (x) (m)</th></tr>" +
                "<tr><td>A</td><td>0</td><td>0</td></tr>" +
                "<tr><td>B</td><td>5</td><td>10</td></tr>" +
                "<tr><td>C</td><td>10</td><td>10</td></tr>" +
                "<tr><td>D</td><td>15</td><td>-5</td></tr>" +
                "<tr><td>E</td><td>20</td><td>-5</td></tr>" +
                "<tr><td>F</td><td>25</td><td>20</td></tr>" +
                "</table>" +
                "<p><strong>1. Velocidades Segmentadas:</strong> Calcule la velocidad media para cada tramo (A→B, B→C, etc.).</p>" +
                "<p><strong>2. Desplazamiento, Distancia y Promedios Globales:</strong> Calcule el desplazamiento total, la distancia total, la velocidad media global y la rapidez media para todo el recorrido (A→F).</p>" +
                "<p><strong>3. Tarea Gráfica:</strong> Grafique la posición en función del tiempo (x vs t).</p>"
            ]
        },
        solucion: {
            titulo: "Solución Detallada",
            pasos: [
                {
                    titulo: "1. Velocidades Medias por Tramo",
                    explicacion: "Usamos la fórmula $\\bar{v} = \\frac{\\Delta x}{\\Delta t} = \\frac{x_f - x_i}{t_f - t_i}$ para cada intervalo.",
                    formula: `<strong>Tramo A→B:</strong> $\\bar{v} = \\frac{10 - 0}{5 - 0} = +2.0 \\ \\text{m/s}$<br>
                              <strong>Tramo B→C:</strong> $\\bar{v} = \\frac{10 - 10}{10 - 5} = 0 \\ \\text{m/s}$ (Reposo)<br>
                              <strong>Tramo C→D:</strong> $\\bar{v} = \\frac{-5 - 10}{15 - 10} = \\frac{-15}{5} = -3.0 \\ \\text{m/s}$<br>
                              <strong>Tramo D→E:</strong> $\\bar{v} = \\frac{-5 - (-5)}{20 - 15} = 0 \\ \\text{m/s}$ (Reposo)<br>
                              <strong>Tramo E→F:</strong> $\\bar{v} = \\frac{20 - (-5)}{25 - 20} = \\frac{25}{5} = +5.0 \\ \\text{m/s}$`
                },
                {
                    titulo: "2a. Desplazamiento Total (A→F)",
                    explicacion: "El desplazamiento solo considera la posición inicial y final.",
                    formula: `$\\Delta x_{\\text{total}} = x_F - x_A = 20 \\ \\text{m} - 0 \\ \\text{m} = +20 \\ \\text{m}$`
                },
                {
                    titulo: "2b. Distancia Total Recorrida (A→F)",
                    explicacion: "La distancia es la suma de las magnitudes de los desplazamientos de cada tramo.",
                    formula: `$d = |\\Delta x_{AB}| + |\\Delta x_{BC}| + |\\Delta x_{CD}| + |\\Delta x_{DE}| + |\\Delta x_{EF}|$<br>
                              $d = |10| + |0| + |-15| + |0| + |25| = 10 + 0 + 15 + 0 + 25 = 50 \\ \\text{m}$`
                },
                {
                    titulo: "2c. Velocidad Media y Rapidez Media Globales",
                    explicacion: "La velocidad media usa el desplazamiento total, mientras que la rapidez media usa la distancia total.",
                    formula: `<strong>Velocidad Media Global:</strong> $\\bar{v}_{\\text{global}} = \\frac{\\Delta x_{\\text{total}}}{t_{\\text{total}}} = \\frac{20 \\ \\text{m}}{25 \\ \\text{s}} = +0.80 \\ \\text{m/s}$<br>
                              <strong>Rapidez Media:</strong> $\\text{rapidez} = \\frac{d_{\\text{total}}}{t_{\\text{total}}} = \\frac{50 \\ \\text{m}}{25 \\ \\text{s}} = 2.0 \\ \\text{m/s}$`
                }
            ]
        },
        respuestas: {
            titulo: "Respuestas Finales",
            items: [
                "<strong>Velocidades por tramo:</strong> A→B: +2.0 m/s, B→C: 0 m/s, C→D: -3.0 m/s, D→E: 0 m/s, E→F: +5.0 m/s.",
                "<strong>Desplazamiento Total:</strong> +20 m.",
                "<strong>Distancia Total:</strong> 50 m.",
                "<strong>Velocidad Media Global:</strong> +0.80 m/s.",
                "<strong>Rapidez Media:</strong> 2.0 m/s."
            ]
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        
        const elementosParaRenderizar = [];
        function poblarContenido() {
            const data = ejercicioRectilineo;
            document.getElementById('main-title').innerHTML = data.titulo;
            const enunciadoContainer = document.getElementById('enunciado-container');
            const enunciadoTemplate = document.getElementById('template-enunciado');
            const enunciadoClone = enunciadoTemplate.content.cloneNode(true);
            enunciadoClone.querySelector('.enunciado-titulo').innerHTML = data.enunciado.titulo;
            const parrafosDiv = enunciadoClone.querySelector('.enunciado-parrafos');
            data.enunciado.parrafos.forEach(p => { const pElem = document.createElement('div'); pElem.innerHTML = p; parrafosDiv.appendChild(pElem); });
            enunciadoContainer.appendChild(enunciadoClone);
            elementosParaRenderizar.push(enunciadoContainer);
            const solucionContainer = document.getElementById('solucion-container');
            const solucionTemplate = document.getElementById('template-solucion');
            const solucionHeader = document.createElement('h2');
            solucionHeader.textContent = data.solucion.titulo;
            solucionContainer.appendChild(solucionHeader);
            data.solucion.pasos.forEach(step => { const stepClone = solucionTemplate.content.cloneNode(true); stepClone.querySelector('.solucion-step-titulo').innerHTML = step.titulo; stepClone.querySelector('.solucion-step-explicacion').innerHTML = step.explicacion; if (step.formula) { stepClone.querySelector('.solucion-step-formula').innerHTML = step.formula; } else { stepClone.querySelector('.formula-box').remove(); } solucionContainer.appendChild(stepClone); });
            elementosParaRenderizar.push(solucionContainer);
            const respuestasContainer = document.getElementById('respuestas-container');
            const respuestaTemplate = document.getElementById('template-respuesta');
            const respuestasHeader = document.createElement('h2');
            respuestasHeader.textContent = data.respuestas.titulo;
            respuestasContainer.appendChild(respuestasHeader);
            data.respuestas.items.forEach(item => { const itemClone = respuestaTemplate.content.cloneNode(true); itemClone.querySelector('.respuesta-item').innerHTML = item; respuestasContainer.appendChild(itemClone); });
            elementosParaRenderizar.push(respuestasContainer);
        }
        
        function renderizarFormulas() {
            // Esta función ahora solo se llama a través del evento, lo que es seguro.
            if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                MathJax.typesetPromise(elementosParaRenderizar).catch((err) => console.error("Error al renderizar MathJax:", err));
            }
        }
        
        poblarContenido();
        // --- CORRECCIÓN 2: Usar solo el event listener para mayor fiabilidad ---
        document.addEventListener('MathJaxReady', renderizarFormulas);

        // --- Lógica de la Gráfica SVG Interactiva (sin cambios) ---
        const svg = document.getElementById('grafica-svg');
        const descriptionBox = document.getElementById('anim-description');
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');

        const dataPoints = [
            { t: 0, x: 0, label: 'A' }, { t: 5, x: 10, label: 'B' },
            { t: 10, x: 10, label: 'C' }, { t: 15, x: -5, label: 'D' },
            { t: 20, x: -5, label: 'E' }, { t: 25, x: 20, label: 'F' }
        ];
        const velocities = [2.0, 0, -3.0, 0, 5.0];

        const SVG_WIDTH = 500, SVG_HEIGHT = 400;
        const MARGIN = { top: 40, right: 40, bottom: 40, left: 50 };
        const G_WIDTH = SVG_WIDTH - MARGIN.left - MARGIN.right;
        const G_HEIGHT = SVG_HEIGHT - MARGIN.top - MARGIN.bottom;

        const scaleX = t => MARGIN.left + (t / 25) * G_WIDTH;
        const scaleY = x => MARGIN.top + G_HEIGHT - ((x + 5) / 25) * G_HEIGHT;

        let svgContent = `<g class="axes">
            <line x1="${MARGIN.left}" y1="${MARGIN.top}" x2="${MARGIN.left}" y2="${MARGIN.top + G_HEIGHT}" stroke="#333" />
            <line x1="${MARGIN.left}" y1="${scaleY(0)}" x2="${MARGIN.left + G_WIDTH}" y2="${scaleY(0)}" stroke="#333" />
            <text x="${MARGIN.left - 10}" y="${MARGIN.top - 10}" text-anchor="middle" font-size="14" font-family="Oswald">x (m)</text>
            <text x="${MARGIN.left + G_WIDTH + 20}" y="${scaleY(0) + 5}" font-size="14" font-family="Oswald">t (s)</text>`;
        for (let t = 0; t <= 25; t += 5) {
            svgContent += `<text x="${scaleX(t)}" y="${scaleY(0) + 20}" text-anchor="middle" font-size="12">${t}</text>`;
        }
        for (let x = -5; x <= 20; x += 5) {
            svgContent += `<text x="${MARGIN.left - 15}" y="${scaleY(x) + 4}" text-anchor="end" font-size="12">${x}</text>
                           <line x1="${MARGIN.left}" y1="${scaleY(x)}" x2="${MARGIN.left + G_WIDTH}" y2="${scaleY(x)}" stroke="#ccc" stroke-dasharray="2 2"/>`;
        }
        svgContent += `</g>`;

        for (let i = 0; i < dataPoints.length - 1; i++) {
            svgContent += `<line id="segment-${i}" x1="${scaleX(dataPoints[i].t)}" y1="${scaleY(dataPoints[i].x)}"
                                x2="${scaleX(dataPoints[i+1].t)}" y2="${scaleY(dataPoints[i+1].x)}"
                                stroke="var(--graph-line-color)" stroke-width="3" visibility="hidden" />`;
        }
        svgContent += `<circle id="marker" r="6" fill="var(--accent-color)" visibility="hidden" />`;
        svg.innerHTML = svgContent;

        const marker = document.getElementById('marker');
        const segments = Array.from({ length: 5 }, (_, i) => document.getElementById(`segment-${i}`));

        let currentStep = 0;
        const totalSteps = 6;

        function updateVisualization(step) {
            btnPrev.disabled = step === 0;
            btnNext.disabled = step === totalSteps - 1;

            if (step === 0) {
                descriptionBox.innerHTML = "<strong>Estado Inicial:</strong> Gráfica vacía. Presiona 'Siguiente' para empezar.";
                marker.setAttribute('visibility', 'hidden');
            } else {
                const point = dataPoints[step];
                const prevPoint = dataPoints[step - 1];
                descriptionBox.innerHTML = `<strong>Tramo ${prevPoint.label}→${point.label}</strong> (t=${prevPoint.t}s a t=${point.t}s)<br>Velocidad Media: <strong>${velocities[step-1].toFixed(1)} m/s</strong>`;
                marker.setAttribute('cx', scaleX(point.t));
                marker.setAttribute('cy', scaleY(point.x));
                marker.setAttribute('visibility', 'visible');
            }

            segments.forEach((seg, i) => {
                seg.setAttribute('visibility', i < step ? 'visible' : 'hidden');
            });
        }

        btnNext.addEventListener('click', () => { if (currentStep < totalSteps - 1) { currentStep++; updateVisualization(currentStep); } });
        btnPrev.addEventListener('click', () => { if (currentStep > 0) { currentStep--; updateVisualization(currentStep); } });
        updateVisualization(0);
    });
    </script>

</body>
</html>